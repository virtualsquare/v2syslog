.\" Copyright (C) 2022 VirtualSquare. Project Leader: Renzo Davoli
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License,
.\" as published by the Free Software Foundation, either version 2
.\" of the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston,
.\" MA 02110-1301 USA.
.\"
.\" Automatically generated by Pandoc 3.1.11
.\"
.TH "V2SYSLOG" "3" "January 2024" "VirtualSquare" "Library Functions Manual"
.SH NAME
v2openlog, v2closelog, v2syslog, v2vsyslog, v2setlog, v2syslogx,
v2vsyslogx \- send messages to a local or networked logger
.SH SYNOPSIS
\f[CB]#include <v2syslog.h>\f[R]
.PP
\f[CB]void v2openlog(const char *\f[R] \f[I]ident\f[R]\f[CB], int\f[R]
\f[I]option,\f[R]\f[CB]int\f[R] \f[I]facility\f[R]\f[CB]);\f[R]
.PP
\f[CB]void v2closelog(void);\f[R]
.PP
\f[CB]void v2syslog(int\f[R] \f[I]priority\f[R]\f[CB], const char *\f[R]
\f[I]format\f[R]\f[CB], ...);\f[R]
.PP
\f[CB]void v2vsyslog(int\f[R]
\f[I]priority\f[R]\f[CB], const char *\f[R]
\f[I]format\f[R]\f[CB], va_list\f[R] \f[I]ap\f[R]\f[CB]);\f[R]
.PP
\f[CB]void v2setlog(struct ioth *\f[R]
\f[I]stack\f[R]\f[CB], struct v2syslog_server\f[R]
\f[I]server\f[R]\f[CB], const char *\f[R]
\f[I]hostname\f[R]\f[CB], const char *\f[R]
\f[I]procid\f[R]\f[CB]);\f[R]
.PP
\f[CB]void v2syslogx(int\f[R]
\f[I]priority\f[R]\f[CB], const char *\f[R]
\f[I]msg_id\f[R]\f[CB], const char *\f[R]
\f[I]struct_data\f[R]\f[CB], const char *\f[R]
\f[I]format\f[R]\f[CB], ...);\f[R]
.PP
\f[CB]void v2vsyslogx(int\f[R]
\f[I]priority\f[R]\f[CB], const char *\f[R]
\f[I]msg_id\f[R]\f[CB], const char *\f[R]
\f[I]struct_data\f[R]\f[CB], const char *\f[R]
\f[I]format\f[R]\f[CB], va_list\f[R] \f[I]ap\f[R]\f[CB]);\f[R]
.SH DESCRIPTION
\f[CB]v2syslog\f[R] is a library which enables daemon processes to route
their log messages to local or networked logging services.
.PP
It is an extension of \f[CB]syslog\f[R](3).
\f[CB]v2syslog\f[R] has been designed for Virtualsquare processes:
.IP \[bu] 2
Internet of Threads (IoTh) processes are network nodes, having their own
personality on the network (IP address, independent TCP\-IP stack).
The physical host (e.g.\ Linux box) they are currently running on is
merely incidental.
The local syslogd has no roles in this architecture.
.IP \[bu] 2
By VUOS users can run their own daemons in user space, using user
privileges.
All VUOS modules create specific execution environments for processes,
likewise if they were some sort of user level implemented namespaces:
neither root access nor specific capabilities are required.
Using the currently available syslog implementation users can run their
daemons but root access is required to read the log messsages
(e.g.\ read the /var/log/syslog file) or configure syslog to store or
process log messages elsewhere (e.g.\ by editing /etc/syslog.conf file)
.PP
This library provides the following functions:
.TP
\f[CB]v2openlog()\f[R]
\f[CB]v2openlog()\f[R] opens a connection to the system logger for a
program.
The arguments are the same of \f[CB]openlog\f[R](3).
The values that may be specified for \f[I]option\f[R] are described
below.
.TP
\f[CB]v2closelog()\f[R]
\f[CB]v2closelog()\f[R] closes the file descriptor being used to write
to the system logger.
The use of closelog() is optional.
.TP
\f[CB]v2syslog()\f[R], \f[CB]v2vsyslog()\f[R]
\f[CB]v2syslog()\f[R] generates and send a log message that can be
processed by \f[CB]syslogd\f[R](8) or \f[CB]v2syslogd\f[R](1) or any
other
logger using the protocols defined by RFC 3124 or RFC 5424.
The arguments are the same of \f[CB]syslog\f[R](3) or
\f[CB]vsyslog\f[R](3).
.TP
\f[CB]v2setlog()\f[R]
\f[CB]v2setlog()\f[R] defines the logging service to use.
\f[I]stack\f[R] is the Internet of Thread stack to use (the kernel
provided stack
is used if \f[I]stack\f[R] is NULL).
.RS
.PP
\f[I]server\f[R] defines the logging server address.
Some convenient macros are provided to set this argument:
.RE
.RS
.RS
.PP
\f[CB]v2syslog_UNIX(\f[R]\f[I]PATH\f[R]\f[CB])\f[R]: the deamon is
reachable at the UNIX socket \f[I]PATH\f[R].
.RE
.RE
.RS
.RS
.PP
\f[CB]v2syslog_INET(\f[R]\f[I]ADDR\f[R]\f[CB],\f[R]\f[I]PORT\f[R]\f[CB])\f[R]:
the daemon is available at the IPv4 address \f[I]ADDR\f[R], the port is
\f[I]PORT\f[R].
\f[I]ADDR\f[R] is a pointer to a \f[I]struct in_addr\f[R] (in network
byte order).
.RE
.RE
.RS
.RS
.PP
\f[CB]v2syslog_INET6(\f[R]\f[I]ADDR\f[R]\f[CB],\f[R]
\f[I]PORT\f[R]\f[CB])\f[R]: the daemon is available at the IPv6 address
\f[I]ADDR\f[R], the port is \f[I]PORT\f[R].
\f[I]ADDR\f[R] is a pointer to a \f[I]struct in6_addr\f[R] (in network
byte order).
.RE
.RE
.RS
.PP
\f[I]hostname\f[R] defines the hostname value included in log messages
(\f[I]nodename\f[R] returned by \f[CB]uname(2)\f[R] is used if
\f[I]hostname\f[R] is NULL)
.RE
.RS
.PP
\f[I]procid\f[R] defines the procid value for the log messages (the
output of \f[CB]getpid\f[R](2) or \f[CB]gettid\f[R](2) is used if this
argment is NULL).
.RE
.TP
\f[CB]v2syslogx()\f[R], \f[CB]v2vsyslogx()\f[R]
These functions extend \f[CB]v2syslog()\f[R] and \f[CB]v2vsyslog()\f[R]
respectively.
Two further arguments are provided:
\f[I]msg_id\f[R] define the message id (6.2.7 of RFC 5424),
\f[I]struct_data\f[R] define the structured\-date (6.3 of RFC 5424).
.TP
Values for \f[I]option\f[R]:
The \f[I]option\f[R] argument to \f[CB]v2openlog()\f[R] is a bit mask.
Its value is the bitwise\-or of the values defined for
\f[CB]openlog\f[R](3)
and the following values:
.RS
.PP
\f[CB]LOG_STREAM\f[R] try to send log messages using stream sockets (TCP
or UNIX\-STREAM)
.RE
.RS
.PP
\f[CB]LOG_STREAM_ONLY\f[R] send log messages using stream sockets (TCP
or UNIX\-STREAM) only
.RE
.RS
.PP
\f[CB]LOG_DGRAM_ONLY\f[R] send log messages using datagram sockets (UDP
or UNIX\-DGRAM) only
.RE
.RS
.PP
\f[CB]LOG_3164\f[R] use the protocol defined in RFC 3164
.RE
.RS
.PP
\f[CB]LOG_5424\f[R] use the protocol defined in RFC 5424
.RE
.RS
.PP
\f[CB]LOG_FRAMING_COUNT\f[R] use the octet counting (3.1.1 of RFC 6587)
.RE
.RS
.PP
\f[CB]LOG_USE_TID\f[R] send tid (thread id) instead of pid
.RE
.SH AUTHOR
VirtualSquare.
Project leader: Renzo Davoli
